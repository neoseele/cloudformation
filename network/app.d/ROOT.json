{
    "AWSTemplateFormatVersion":"2010-09-09",
    "Description":"VPC App",
    "Mappings":{
        "AWSInstanceType2Arch":{
            "c1.medium":{
                "Arch":"PV64"
            },
            "c1.xlarge":{
                "Arch":"PV64"
            },
            "c3.2xlarge":{
                "Arch":"HVM64"
            },
            "c3.4xlarge":{
                "Arch":"HVM64"
            },
            "c3.8xlarge":{
                "Arch":"HVM64"
            },
            "c3.large":{
                "Arch":"HVM64"
            },
            "c3.xlarge":{
                "Arch":"HVM64"
            },
            "c4.2xlarge":{
                "Arch":"HVM64"
            },
            "c4.4xlarge":{
                "Arch":"HVM64"
            },
            "c4.8xlarge":{
                "Arch":"HVM64"
            },
            "c4.large":{
                "Arch":"HVM64"
            },
            "c4.xlarge":{
                "Arch":"HVM64"
            },
            "cc2.8xlarge":{
                "Arch":"HVM64"
            },
            "cr1.8xlarge":{
                "Arch":"HVM64"
            },
            "g2.2xlarge":{
                "Arch":"HVMG2"
            },
            "hi1.4xlarge":{
                "Arch":"HVM64"
            },
            "hs1.8xlarge":{
                "Arch":"HVM64"
            },
            "i2.2xlarge":{
                "Arch":"HVM64"
            },
            "i2.4xlarge":{
                "Arch":"HVM64"
            },
            "i2.8xlarge":{
                "Arch":"HVM64"
            },
            "i2.xlarge":{
                "Arch":"HVM64"
            },
            "m1.large":{
                "Arch":"PV64"
            },
            "m1.medium":{
                "Arch":"PV64"
            },
            "m1.small":{
                "Arch":"PV64"
            },
            "m1.xlarge":{
                "Arch":"PV64"
            },
            "m2.2xlarge":{
                "Arch":"PV64"
            },
            "m2.4xlarge":{
                "Arch":"PV64"
            },
            "m2.xlarge":{
                "Arch":"PV64"
            },
            "m3.2xlarge":{
                "Arch":"HVM64"
            },
            "m3.large":{
                "Arch":"HVM64"
            },
            "m3.medium":{
                "Arch":"HVM64"
            },
            "m3.xlarge":{
                "Arch":"HVM64"
            },
            "r3.2xlarge":{
                "Arch":"HVM64"
            },
            "r3.4xlarge":{
                "Arch":"HVM64"
            },
            "r3.8xlarge":{
                "Arch":"HVM64"
            },
            "r3.large":{
                "Arch":"HVM64"
            },
            "r3.xlarge":{
                "Arch":"HVM64"
            },
            "t1.micro":{
                "Arch":"PV64"
            },
            "t2.medium":{
                "Arch":"HVM64"
            },
            "t2.micro":{
                "Arch":"HVM64"
            },
            "t2.small":{
                "Arch":"HVM64"
            }
        },
        "AWSRegionArch2AMI":{
            "ap-northeast-1":{
                "HVM64":"ami-18869819",
                "HVMG2":"ami-2e90892f",
                "PV64":"ami-3c87993d"
            },
            "ap-southeast-1":{
                "HVM64":"ami-96bb90c4",
                "HVMG2":"ami-3e78526c",
                "PV64":"ami-58ba910a"
            },
            "ap-southeast-2":{
                "HVM64":"ami-d50773ef",
                "HVMG2":"ami-315e2a0b",
                "PV64":"ami-1500742f"
            },
            "cn-north-1":{
                "HVM64":"ami-981d8fa1",
                "HVMG2":"NOT_SUPPORTED",
                "PV64":"ami-8a1d8fb3"
            },
            "eu-central-1":{
                "HVM64":"ami-04003319",
                "HVMG2":"NOT_SUPPORTED",
                "PV64":"ami-0600331b"
            },
            "eu-west-1":{
                "HVM64":"ami-9d23aeea",
                "HVMG2":"ami-4d7cf03a",
                "PV64":"ami-7b3db00c"
            },
            "sa-east-1":{
                "HVM64":"ami-af9925b2",
                "HVMG2":"NOT_SUPPORTED",
                "PV64":"ami-fd9925e0"
            },
            "us-east-1":{
                "HVM64":"ami-146e2a7c",
                "HVMG2":"ami-7200461a",
                "PV64":"ami-8e682ce6"
            },
            "us-west-1":{
                "HVM64":"ami-42908907",
                "HVMG2":"ami-244b5361",
                "PV64":"ami-f49089b1"
            },
            "us-west-2":{
                "HVM64":"ami-dfc39aef",
                "HVMG2":"ami-0b78203b",
                "PV64":"ami-9fc29baf"
            }
        }
    },
    "Outputs":{
        "WebsiteURL":{
            "Description":"URL for newly created LAMP stack",
            "Value":{
                "Fn::Join":[
                    "",
                    [
                        "http://",
                        {
                            "Fn::GetAtt":[
                                "ElasticLoadBalancer",
                                "DNSName"
                            ]
                        }
                    ]
                ]
            }
        }
    },
    "Parameters":{
        "ApplicationSubnets":{
            "Description":"Application subnets",
            "Type":"CommaDelimitedList"
        },
        "DBAllocatedStorage":{
            "ConstraintDescription":"must be between 5 and 1024Gb.",
            "Default":"5",
            "Description":"The size of the database (Gb)",
            "MaxValue":"1024",
            "MinValue":"5",
            "Type":"Number"
        },
        "DBInstanceClass":{
            "AllowedValues":[
                "db.t1.micro",
                "db.m1.small",
                "db.m1.medium",
                "db.m1.large",
                "db.m1.xlarge",
                "db.m2.xlarge",
                "db.m2.2xlarge",
                "db.m2.4xlarge",
                "db.m3.medium",
                "db.m3.large",
                "db.m3.xlarge",
                "db.m3.2xlarge",
                "db.r3.large",
                "db.r3.xlarge",
                "db.r3.2xlarge",
                "db.r3.4xlarge",
                "db.r3.8xlarge",
                "db.m2.xlarge",
                "db.m2.2xlarge",
                "db.m2.4xlarge",
                "db.cr1.8xlarge"
            ],
            "ConstraintDescription":"must select a valid database instance type.",
            "Default":"db.t1.micro",
            "Description":"The database instance type",
            "Type":"String"
        },
        "DBName":{
            "AllowedPattern":"[a-zA-Z][a-zA-Z0-9]*",
            "ConstraintDescription":"must begin with a letter and contain only alphanumeric characters.",
            "Default":"myDatabase",
            "Description":"MySQL database name",
            "MaxLength":"64",
            "MinLength":"1",
            "Type":"String"
        },
        "DBPassword":{
            "AllowedPattern":"[a-zA-Z0-9]*",
            "ConstraintDescription":"must contain only alphanumeric characters.",
            "Description":"Password for MySQL database access",
            "MaxLength":"41",
            "MinLength":"8",
            "NoEcho":"true",
            "Type":"String"
        },
        "DBUser":{
            "AllowedPattern":"[a-zA-Z][a-zA-Z0-9]*",
            "ConstraintDescription":"must begin with a letter and contain only alphanumeric characters.",
            "Description":"Username for MySQL database access",
            "MaxLength":"16",
            "MinLength":"1",
            "NoEcho":"true",
            "Type":"String"
        },
        "DatabaseSubnets":{
            "Description":"RDS subnets",
            "Type":"CommaDelimitedList"
        },
        "InstanceType":{
            "AllowedValues":[
                "t1.micro",
                "t2.micro",
                "t2.small",
                "t2.medium",
                "m1.small",
                "m1.medium",
                "m1.large",
                "m1.xlarge",
                "m2.xlarge",
                "m2.2xlarge",
                "m2.4xlarge",
                "m3.medium",
                "m3.large",
                "m3.xlarge",
                "m3.2xlarge",
                "c1.medium",
                "c1.xlarge",
                "c3.large",
                "c3.xlarge",
                "c3.2xlarge",
                "c3.4xlarge",
                "c3.8xlarge",
                "c4.large",
                "c4.xlarge",
                "c4.2xlarge",
                "c4.4xlarge",
                "c4.8xlarge",
                "g2.2xlarge",
                "r3.large",
                "r3.xlarge",
                "r3.2xlarge",
                "r3.4xlarge",
                "r3.8xlarge",
                "i2.xlarge",
                "i2.2xlarge",
                "i2.4xlarge",
                "i2.8xlarge",
                "hi1.4xlarge",
                "hs1.8xlarge",
                "cr1.8xlarge",
                "cc2.8xlarge",
                "cg1.4xlarge"
            ],
            "ConstraintDescription":"must be a valid EC2 instance type.",
            "Default":"t2.micro",
            "Description":"WebServer EC2 instance type",
            "Type":"String"
        },
        "KeyName":{
            "ConstraintDescription":"must be the name of an existing EC2 KeyPair.",
            "Description":"Name of an existing EC2 KeyPair to enable SSH access to the instances",
            "Type":"AWS::EC2::KeyPair::KeyName"
        },
        "LoadBalancerSubnets":{
            "Description":"Load Balancer subnets",
            "Type":"CommaDelimitedList"
        },
        "MultiAZDatabase":{
            "AllowedValues":[
                "true",
                "false"
            ],
            "ConstraintDescription":"must be either true or false.",
            "Default":"false",
            "Description":"Create a Multi-AZ MySQL Amazon RDS database instance",
            "Type":"String"
        },
        "NatSecurityGroup":{
            "Description":"",
            "Type":"String"
        },
        "Vpc":{
            "Description":"",
            "Type":"String"
        },
        "WebServerCapacity":{
            "ConstraintDescription":"must be between 1 and 5 EC2 instances.",
            "Default":"2",
            "Description":"The initial nuber of WebServer instances",
            "MaxValue":"5",
            "MinValue":"1",
            "Type":"Number"
        }
    },
    "Resources":[
        "DBEC2SecurityGroup",
        "DBSubnetGroup",
        "ElasticLoadBalancer",
        "LaunchConfig",
        "LoadBalancerSecurityGroup",
        "MySQLDatabase",
        "WebServerGroup",
        "WebServerSecurityGroup"
    ]
}