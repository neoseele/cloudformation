{
  "AWSTemplateFormatVersion" : "2010-09-09",

  "Description" : "VPC Subnets",

  "Parameters" : {

    "VPC" : {
      "Description" : "VPC",
      "Type" : "String"
    },

    "ExternalCIDR" : {
      "Description" : "",
      "Type" : "String"
    },

    "ExternalLoadBalancerCIDR" : {
      "Description" : "",
      "Type" : "String"
    },

    "ApplicationCIDR" : {
      "Description" : "",
      "Type" : "String"
    },

    "DatabaseCIDR" : {
      "Description" : "",
      "Type" : "String"
    },

    "ExternalRouteTable" : {
      "Description" : "",
      "Type" : "String"
    },

    "InternalRouteTable" : {
      "Description" : "",
      "Type" : "String"
    },

    "AvailabilityZone" : {
      "Description" : "",
      "Type" : "String"
    },

    "Region" : {
      "Description" : "",
      "Type" : "String"
    },

    "Environment" : {
      "Description" : "",
      "Type" : "String"
    }

    "InternalAcl" : {
      "Description" : "",
      "Type" : "String"
    }

    "ExternalAcl" : {
      "Description" : "",
      "Type" : "String"
    }
  },

  "Mappings" : {
    "Case" : {
      "A" : { "Low" : "a" },
      "B" : { "Low" : "b" },
      "C" : { "Low" : "c" },
      "D" : { "Low" : "d" }
    }
  },

  "Resources" : {

    "ExternalSubnet" : {
      "Type" : "AWS::EC2::Subnet",
      "Properties" : {
        "VpcId" : { "Ref" : "VPC" },
        "AvailabilityZone" : { "Fn::Join" : [ "", [ {"Ref" : "Region"}, { "Fn::FindInMap": [ "Case", {"Ref" : "AvailabilityZone" }, "Low" ] } ]] },
        "CidrBlock" : { "Ref" : "ExternalCIDR" },
        "Tags" : [
          { "Key" : "Applicationlication", "Value" : { "Ref" : "AWS::StackName" } },
          { "Key" : "Network", "Value" : "External" },
          { "Key" : "Name", "Value" : { "Fn::Join" : [ "", [ { "Ref" : "Environment" }, "External", { "Ref" : "AvailabilityZone" } ]] }}
        ]
      }
    },

    "ExternalLoadBalancerSubnet" : {
      "Type" : "AWS::EC2::Subnet",
      "Properties" : {
        "VpcId" : { "Ref" : "VPC" },
        "AvailabilityZone" : { "Fn::Join" : [ "", [ {"Ref" : "Region"}, { "Fn::FindInMap": [ "Case", {"Ref" : "AvailabilityZone" }, "Low" ] } ]] },
        "CidrBlock" : { "Ref" : "ExternalLoadBalancerCIDR" },
        "Tags" : [
          { "Key" : "Applicationlication", "Value" : { "Ref" : "AWS::StackName" } },
          { "Key" : "Network", "Value" : "External" },
          { "Key" : "Name", "Value" : { "Fn::Join" : [ "", [ { "Ref" : "Environment" }, "ExternalLoadBalancer", { "Ref" : "AvailabilityZone" } ]] }}
        ]
      }
    },

    "ApplicationSubnet" : {
      "Type" : "AWS::EC2::Subnet",
      "Properties" : {
        "VpcId" : { "Ref" : "VPC" },
        "AvailabilityZone" : { "Fn::Join" : [ "", [ {"Ref" : "Region"}, { "Fn::FindInMap": [ "Case", {"Ref" : "AvailabilityZone" }, "Low" ] } ]] },
        "CidrBlock" : { "Ref" : "ApplicationCIDR" },
        "Tags" : [
          { "Key" : "Applicationlication", "Value" : { "Ref" : "AWS::StackName" } },
          { "Key" : "Network", "Value" : "Application" },
          { "Key" : "Name", "Value" : { "Fn::Join" : [ "", [ { "Ref" : "Environment" }, "Application", { "Ref" : "AvailabilityZone" } ]] }}
        ]
      }
    },

    "DatabaseSubnet" : {
      "Type" : "AWS::EC2::Subnet",
      "Properties" : {
        "VpcId" : { "Ref" : "VPC" },
        "AvailabilityZone" : { "Fn::Join" : [ "", [ {"Ref" : "Region"}, { "Fn::FindInMap": [ "Case", {"Ref" : "AvailabilityZone" }, "Low" ] } ]] },
        "CidrBlock" : { "Ref" : "DatabaseCIDR" },
        "Tags" : [
          { "Key" : "Applicationlication", "Value" : { "Ref" : "AWS::StackName" } },
          { "Key" : "Network", "Value" : "Application" },
          { "Key" : "Name", "Value" : { "Fn::Join" : [ "", [ { "Ref" : "Environment" }, "Database", { "Ref" : "AvailabilityZone" } ]] }}
        ]
      }
    },

    "ExternalSubnetRouteTableAssociation" : {
      "Type" : "AWS::EC2::SubnetRouteTableAssociation",
      "Properties" : {
        "SubnetId" : { "Ref" : "ExternalSubnet" },
        "RouteTableId" : { "Ref" : "ExternalRouteTable" }
      }
    },

    "ExternalLoadBalancerSubnetRouteTableAssociation" : {
      "Type" : "AWS::EC2::SubnetRouteTableAssociation",
      "Properties" : {
        "SubnetId" : { "Ref" : "ExternalLoadBalancerSubnet" },
        "RouteTableId" : { "Ref" : "ExternalRouteTable" }
      }
    },

    "ApplicationSubnetRouteTableAssociation" : {
      "Type" : "AWS::EC2::SubnetRouteTableAssociation",
      "Properties" : {
        "SubnetId" : { "Ref" : "ApplicationSubnet" },
        "RouteTableId" : { "Ref" : "InternalRouteTable" }
      }
    },

    "DatabaseSubnetRouteTableAssociation" : {
      "Type" : "AWS::EC2::SubnetRouteTableAssociation",
      "Properties" : {
        "SubnetId" : { "Ref" : "DatabaseSubnet" },
        "RouteTableId" : { "Ref" : "InternalRouteTable" }
      }
    },

    "ExternalSubnetAclAssociation" : {
      "Type" : "AWS::EC2::SubnetNetworkAclAssociation",
      "Properties" : {
        "SubnetId" : { "Ref" : "ExternalSubnet" },
        "NetworkAclId" : { "Ref" : "ExternalAcl" }
      }
    },

    "ApplicationSubnetAclAssociation" : {
      "Type" : "AWS::EC2::SubnetNetworkAclAssociation",
      "Properties" : {
        "SubnetId" : { "Ref" : "ApplicationSubnet" },
        "NetworkAclId" : { "Ref" : "InternalAcl" }
      }
    }

  }
}
