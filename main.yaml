# MegaStack name. All stacks in CF get prefixed with this name.
---
A1:
  Name: &Name A1
  region: &Region ap-southeast-2
  ServicePhase: &ServicePhase Dev
  KeyName: &KeyName nmiao
  VpcCidrRange: &VpcCidrRange 10.0.0.0/16
  ExternalLoadBalancerA: &ExternalLoadBalancerA 10.0.0.0/24
  ExternalLoadBalancerB: &ExternalLoadBalancerB 10.0.128.0/24
  ExternalA: &ExternalA 10.0.1.0/24
  ExternalB: &ExternalB 10.0.129.0/24
  ApplicationA: &ApplicationA 10.0.2.0/24
  ApplicationB: &ApplicationB 10.0.130.0/24
  DatabaseA: &DatabaseA 10.0.3.0/24
  DatabaseB: &DatabaseB 10.0.131.0/24
  ServerAccess: &ServerAccess 115.64.236.212/32

  stacks:
    Common:
      cf_template: common.json
      depends:
      params:
        CIDR:
          value: *VpcCidrRange
        ServicePhase:
          value: *ServicePhase
    SubnetAzA:
      cf_template: subnet.json
      depends:
        - Common
      params:
        AvailabilityZone:
          value: A
        VPC:
          source: Common
          type: resource
          variable: VPC
        ExternalRouteTable:
          source: Common
          type: resource
          variable: ExternalRouteTable
        InternalRouteTable:
          source: Common
          type: resource
          variable: InternalRouteTable
        ExternalAcl:
          source: Common
          type: resource
          variable: ExternalAcl
        InternalAcl:
          source: Common
          type: resource
          variable: InternalAcl
        NATSecurityGroup:
          source: Common
          type: resource
          variable: NATSecurityGroup
        ExternalCIDR:
          value: *ExternalA
        ExternalLoadBalancerCIDR:
          value: *ExternalLoadBalancerA
        ApplicationCIDR:
          value: *ApplicationA
        DatabaseCIDR:
          value: *DatabaseA
        ServicePhase:
          value: *ServicePhase
        ServerAccess:
          value: *ServerAccess
        KeyName:
          value: *KeyName
    SubnetAzB:
      cf_template: subnet.json
      depends:
        - Common
      params:
        AvailabilityZone:
          value: B
        VPC:
          source: Common
          type: resource
          variable: VPC
        ExternalRouteTable:
          source: Common
          type: resource
          variable: ExternalRouteTable
        InternalRouteTable:
          source: Common
          type: resource
          variable: InternalRouteTable
        ExternalAcl:
          source: Common
          type: resource
          variable: ExternalAcl
        InternalAcl:
          source: Common
          type: resource
          variable: InternalAcl
        NATSecurityGroup:
          source: Common
          type: resource
          variable: NATSecurityGroup
        ExternalCIDR:
          value: *ExternalB
        ExternalLoadBalancerCIDR:
          value: *ExternalLoadBalancerB
        ApplicationCIDR:
          value: *ApplicationB
        DatabaseCIDR:
          value: *DatabaseB
        ServicePhase:
          value: *ServicePhase
        ServerAccess:
          value: *ServerAccess
        KeyName:
          value: *KeyName
    Shared:
      cf_template: shared.json
      depends:
        - SubnetAzA
      params:
        VPC:
          source: Common
          type: resource
          variable: VPC
        NATInstance:
          source: SubnetAzA
          type: resource
          variable: NATInstance
        InternalRouteTable:
          source: Common
          type: resource
          variable: InternalRouteTable
        ServicePhase:
          value: *ServicePhase
    App:
      cf_template: app.json
      depends:
        - SubnetAzA
        - SubnetAzB
      params:
        Common:
          source: Common
          type: resource
          variable: Common
        LoadBalancerSubnets:
          - source: SubnetAzA
            type: resource
            variable: ExternalLoadBalancerSubnet
          - source: SubnetAzB
            type: resource
            variable: ExternalLoadBalancerSubnet
        DatabaseSubnets:
          - source: SubnetAzA
            type: resource
            variable: DatabaseSubnet
          - source: SubnetAzB
            type: resource
            variable: DatabaseSubnet
        ApplicationSubnets:
          - source: SubnetAzA
            type: resource
            variable: ApplicationSubnet
          - source: SubnetAzB
            type: resource
            variable: ApplicationSubnet
        NATSecurityGroup:
          source: NAT
          type: resource
          variable: NATSecurityGroup
        DBName:
          value: drupal
        DBUser:
          value: drupal
        DBPassword:
          value: drupal123
        MultiAZDatabase:
          value: "false"
        KeyName:
          value: *KeyName
        ServicePhase:
          value: *ServicePhase

